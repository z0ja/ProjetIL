<!DOCTYPE html>
<html lang="fr">
    <head>
	<meta charset="utf-8">
	<title>créez votre room</title>
    </head>
    <body>
	<form id="join-room-form">
		<label for="room-name">ID de la room</label>
		<input type="text" id="room-name" name="room-name" required>
		<button type="submit">rejoindre</button>
	</form>
	<div id="error"></div>
    </body>
	<script src="http://localhost:3004/socket.io/socket.io.js"></script>
	<script>
		const socket = io(":3004");
		const user = JSON.parse(localStorage.getItem("user"));
		let currentRoomId = null;

		document.getElementById("join-room-form").addEventListener("submit", (e) => {
			document.getElementById("error").innerHTML = "";
			e.preventDefault();
			currentRoomId = document.getElementById("room-name").value;
			socket.emit("user connect", currentRoomId, user.id);
		});

		socket.on('no id', (userId) => {
			if(userId == user.id){
				document.getElementById("error").innerHTML = "cette ID ne correspond à aucune room";
			}
		});

		socket.on('accepted', (room, userId, listeParticipant) => {
			console.log(room);
			localStorage.setItem('roomObject', JSON.stringify(room));
			localStorage.setItem('listeParticipant', JSON.stringify(listeParticipant));
			window.location.href = "./room.html";
		});
	</script>
</html>

